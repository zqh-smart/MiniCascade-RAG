# æ—…è¡Œè§„åˆ’Agentç³»ç»Ÿ

ä¸€ä¸ªå…·å¤‡"å¤šæ­¥è§„åˆ’ä¸çŠ¶æ€ç®¡ç†"èƒ½åŠ›çš„æ—…è¡Œè§„åˆ’AI Agentï¼Œèƒ½å¤Ÿå°†å¤æ‚çš„æ—…è¡Œè¯·æ±‚æ‹†è§£æˆå¤šä¸ªå­ä»»åŠ¡ï¼Œå¹¶ç®¡ç†æ‰§è¡ŒçŠ¶æ€å’Œä¾èµ–å…³ç³»ã€‚

## ğŸ¯ è®¾è®¡å“²å­¦

### æ•´ä½“æ¶æ„è®¾è®¡

æœ¬é¡¹ç›®é‡‡ç”¨åŸºäºLangGraphçš„çŠ¶æ€æœºæ¶æ„ï¼Œé€šè¿‡å¤šä¸ªèŠ‚ç‚¹ååŒå·¥ä½œæ¥å®Œæˆå¤æ‚çš„æ—…è¡Œè§„åˆ’ä»»åŠ¡ï¼š

1. **ä»»åŠ¡è§„åˆ’èŠ‚ç‚¹ (planning_agent_node)**ï¼šæ¥æ”¶ç”¨æˆ·è¯·æ±‚ï¼Œä½¿ç”¨å¤§è¯­è¨€æ¨¡å‹å°†å¤æ‚è¯·æ±‚åˆ†è§£ä¸ºç»“æ„åŒ–ä»»åŠ¡è®¡åˆ’
2. **ä»»åŠ¡æ‰§è¡ŒèŠ‚ç‚¹ (plan_execution_node)**ï¼šæŒ‰ç…§ä»»åŠ¡è®¡åˆ’é¡ºåºæ‰§è¡Œå„é¡¹ä»»åŠ¡ï¼Œç®¡ç†ä»»åŠ¡ä¾èµ–å…³ç³»
3. **é¢„è®¢ç¡®è®¤èŠ‚ç‚¹ (book_flight_and_hotel)**ï¼šæ•´åˆæ‰€æœ‰ä»»åŠ¡ç»“æœï¼Œç”Ÿæˆæœ€ç»ˆçš„é¢„è®¢ç¡®è®¤ä¿¡æ¯

### å…³é”®æŠ€æœ¯é€‰å‹åŠåŸå› 

1. **LangGraphçŠ¶æ€ç®¡ç†**ï¼š
   - é€‰æ‹©åŸå› ï¼šæä¾›å¼ºå¤§çš„çŠ¶æ€ç®¡ç†å’Œå¤æ‚å·¥ä½œæµç¼–æ’èƒ½åŠ›,ä»¥åŠä¸langchainé«˜åº¦é›†æˆ
   - åº”ç”¨ï¼šé€šè¿‡[ResearcherState](file:///D:/GithubProject/MiniCascade-RAG-main/test_question/company_test_airplane/state.py#L17-L32)å’Œ[ResearcherOutputState](file:///D:/GithubProject/MiniCascade-RAG-main/test_question/company_test_airplane/state.py#L33-L41)ç±»å‹åŒ–çŠ¶æ€ç»“æ„ï¼Œå®ç°ç²¾ç¡®çš„çŠ¶æ€æ§åˆ¶å’Œä¼ é€’

2. **å¤§è¯­è¨€æ¨¡å‹é›†æˆ**ï¼š
   - é€‰æ‹©åŸå› ï¼šæä¾›è‡ªç„¶è¯­è¨€ç†è§£å’Œç”Ÿæˆèƒ½åŠ›ï¼Œæ”¯æŒå¤æ‚ä»»åŠ¡è§„åˆ’
   - åº”ç”¨ï¼šä½¿ç”¨DeepSeek-V3æ¨¡å‹è¿›è¡Œä»»åŠ¡åˆ†è§£ã€æ—¥æœŸè§£æã€åŸå¸‚åè½¬IATAä»£ç ç­‰æ™ºèƒ½å¤„ç†

3. **å·¥å…·é©±åŠ¨æ¶æ„**ï¼š
   - é€‰æ‹©åŸå› ï¼šé€šè¿‡å·¥å…·è°ƒç”¨å®ç°ä¸å¤–éƒ¨ç³»ç»Ÿäº¤äº’
   - åº”ç”¨ï¼šå®ç°äº†[search_flights](file:///D:/GithubProject/MiniCascade-RAG-main/test_question/company_test_airplane/utils.py#L173-L223)ã€[search_hotels_with_llm](file:///D:/GithubProject/MiniCascade-RAG-main/test_question/company_test_airplane/utils.py#L225-L255)ç­‰ä¸“é—¨å·¥å…·

4. **ä¾èµ–ç®¡ç†æœºåˆ¶**ï¼š
   - é€‰æ‹©åŸå› ï¼šç¡®ä¿ä»»åŠ¡æŒ‰æ­£ç¡®é¡ºåºæ‰§è¡Œï¼Œå¤„ç†ä»»åŠ¡é—´çš„ä¾èµ–å…³ç³»
   - åº”ç”¨ï¼šé€šè¿‡ä»»åŠ¡IDå’Œä¾èµ–åˆ—è¡¨ç¡®ä¿èˆªç­æŸ¥è¯¢åœ¨é…’åº—æŸ¥è¯¢ä¹‹å‰å®Œæˆ

### çŠ¶æ€ç®¡ç†è®¾è®¡

ç³»ç»Ÿé‡‡ç”¨åˆ†å±‚çŠ¶æ€ç®¡ç†ç­–ç•¥ï¼š

1. **æ‰§è¡Œè®¡åˆ’å­˜å‚¨**ï¼šå­˜å‚¨åˆ†è§£åçš„ç»“æ„åŒ–ä»»åŠ¡åˆ—è¡¨
2. **ä»»åŠ¡æ‰§è¡Œè·Ÿè¸ª**ï¼šè®°å½•å·²æ‰§è¡Œçš„ä»»åŠ¡IDï¼Œé¿å…é‡å¤æ‰§è¡Œ
3. **ç»“æœç¼“å­˜**ï¼šä¿å­˜æ¯ä¸ªä»»åŠ¡çš„æ‰§è¡Œç»“æœï¼Œä¾›åç»­ä»»åŠ¡ä½¿ç”¨
4. **æ¶ˆæ¯ä¼ é€’**ï¼šé€šè¿‡LangChainæ¶ˆæ¯ç³»ç»Ÿåœ¨èŠ‚ç‚¹é—´ä¼ é€’ä¿¡æ¯

## ğŸ› ï¸ ç¯å¢ƒä¸è¿è¡Œ

### ç¯å¢ƒé…ç½®

1. **Pythonç‰ˆæœ¬è¦æ±‚**ï¼š
   - Python >= 3.11

2. **ä¾èµ–å®‰è£…**ï¼š
   ```bash
   # æˆ–è€…å¦‚æœä½¿ç”¨ uv (æ¨è)
   uv sync
   ```

3. **ç¯å¢ƒå˜é‡é…ç½®**ï¼š
ï¼ˆè¿™é‡Œç”±äºæ²¡æœ‰æ‰¾åˆ°å…·ä½“çš„é…’åº—apiï¼Œæ‰€ä»¥è¿™é‡Œæ²¡æœ‰ç»™å‡ºé…’åº—apiçš„é…ç½®ï¼‰
   åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `.env` æ–‡ä»¶ï¼Œé…ç½®ä»¥ä¸‹ç¯å¢ƒå˜é‡ï¼š
   ```env
   SILICON_API_KEY=your_siliconflow_api_key
   SILICON_BASE_URL=https://api.siliconflow.cn/v1
   FLIGHT_API_KEY=your_flight_api_key
   FLIGHT_API_URL=your_flight_api_url
   ```

### é¡¹ç›®è¿è¡ŒæŒ‡å—

1. **è¿è¡Œä¸»ç¨‹åº**ï¼š
   ```bash
   python supervisor_agent.py
   ```

2. **è‡ªå®šä¹‰æŸ¥è¯¢**ï¼š
   ä¿®æ”¹[supervisor_agent.py](file:///D:/GithubProject/MiniCascade-RAG-main/test_question/company_test_airplane/supervisor_agent.py)ä¸­çš„æµ‹è¯•è¾“å…¥ï¼š
   ```python
   test_input = {
       "researcher_messages": [
           HumanMessage(
               content="å¸®æˆ‘é¢„è®¢åæœˆäºŒåå·ä»åŒ—äº¬å»æ­¦æ±‰çš„æœºç¥¨å’Œé…’åº—ï¼Œä½ä¸¤æ™šï¼Œæˆ‘çš„åå­—æ˜¯ç‹ä¼Ÿ")
       ]
   }
   ```

## ğŸš€ æˆæœå±•ç¤º

### æ ¸å¿ƒåŠŸèƒ½æ¼”ç¤º

è¿è¡Œé¡¹ç›®åï¼Œç³»ç»Ÿå°†å¤„ç†ç±»ä¼¼ä»¥ä¸‹çš„ç”¨æˆ·è¯·æ±‚ï¼š
```
å¸®æˆ‘é¢„è®¢åæœˆäºŒåå·ä»åŒ—äº¬å»æ­¦æ±‰çš„æœºç¥¨å’Œé…’åº—ï¼Œä½ä¸¤æ™šï¼Œæˆ‘çš„åå­—æ˜¯ç‹ä¼Ÿ
```

### é¢„æœŸè¾“å‡ºæ ¼å¼

ç³»ç»Ÿå°†è¾“å‡ºç»“æ„åŒ–çš„é¢„è®¢ç¡®è®¤ä¿¡æ¯ï¼š
```json
{
  "passenger_name": "ç‹ä¼Ÿ",
  "flight": {
    "flight_number": "èˆªç­å·",
    "airline": "èˆªç©ºå…¬å¸",
    "departure": {
      "airport": "å‡ºå‘æœºåœº",
      "date": "å‡ºå‘æ—¥æœŸ",
      "time": "å‡ºå‘æ—¶é—´"
    },
    "arrival": {
      "airport": "åˆ°è¾¾æœºåœº",
      "date": "åˆ°è¾¾æ—¥æœŸ"
    },
    "duration": "é£è¡Œæ—¶é•¿",
    "price": "ä»·æ ¼"
  },
  "hotel": {
    "name": "é…’åº—åç§°",
    "price_per_night": "æ¯æ™šä»·æ ¼",
    "total_nights": 2
  },
  "total_price": "æ€»ä»·æ ¼"
}
```
å®é™…æ•ˆæœï¼š
é¡¹ç›®æˆæœæ˜¾ç¤ºï¼š
D:\GithubProject\MiniCascade-RAG-main\.venv\Scripts\python.exe "D:/PyCharm 2025.1.3.1/plugins/python-ce/helpers/pydev/pydevd.py" --multiprocess --qt-support=auto --client 127.0.0.1 --port 63000 --file D:\GithubProject\MiniCascade-RAG-main\test_question\company_test_airplane\supervisor_agent.py
D:\PyCharm 2025.1.3.1\plugins\python-ce\helpers\pydev\pydevd_plugins\__init__.py:2: UserWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html. The pkg_resources package is slated for removal as early as 2025-11-30. Refrain from using this package or pin to Setuptools<81.
  __import__('pkg_resources').declare_namespace(__name__)
å·²è¿æ¥åˆ° pydev è°ƒè¯•å™¨(å†…éƒ¨ç‰ˆæœ¬å· 251.26927.90)============================================================
æ­£åœ¨ç¼–è¯‘å’Œæµ‹è¯•ç ”ç©¶å‘˜ Agent...
============================================================
[MAIN] åˆå§‹åŒ–è¾“å…¥: å¸®æˆ‘é¢„è®¢åæœˆäºŒåå·ä»åŒ—äº¬å»æ­¦æ±‰çš„æœºç¥¨å’Œé…’åº—ï¼Œä½ä¸¤æ™šï¼Œæˆ‘çš„åå­—æ˜¯ç‹ä¼Ÿ
[MAIN] å¼€å§‹æ‰§è¡Œ Agent...
æ­£åœ¨æŸ¥è¯¢ 2025-10-20 å‰å¾€ æ­¦æ±‰ çš„èˆªç­...
å·²æ‰¾åˆ°ä»¥ä¸‹èˆªç­: {'airline': 'CA', 'airlineName': 'ä¸­å›½å›½é™…èˆªç©ºå…¬å¸', 'flightNo': 'CA8216', 'isCodeShare': False, 'departure': 'PEK', 'departureName': 'é¦–éƒ½å›½é™…æœºåœº', 'departureDate': '2025-10-20', 'departureTime': '21:25', 'arrivalDate': '2025-10-20', 'arrivalTime': '23:40', 'arrival': 'WUH', 'arrivalName': 'æ­¦æ±‰å¤©æ²³å›½é™…æœºåœº', 'duration': '02h15m', 'transferNum': 1, 'ticketPrice': 520, 'segments': []}
å·²æ‰¾åˆ°ä»¥ä¸‹é…’åº—: [{'name': 'å…¨å­£é…’åº—', 'price_per_night': 300}]
{'passenger_name': 'ç‹ä¼Ÿ', 'flight': {'flight_number': 'CA8216', 'airline': 'ä¸­å›½å›½é™…èˆªç©ºå…¬å¸', 'departure': {'airport': 'é¦–éƒ½å›½é™…æœºåœº', 'date': '2025-10-20', 'time': '21:25'}, 'arrival': {'airport': 'æ­¦æ±‰å¤©æ²³å›½é™…æœºåœº', 'date': '2025-10-20'}, 'duration': '02h15m', 'price': 520}, 'hotel': {'name': 'å…¨å­£é…’åº—', 'price_per_night': 300, 'total_nights': 2}, 'total_price': 1120}
âœ… Agent æ‰§è¡ŒæˆåŠŸ!
### ç³»ç»Ÿç‰¹ç‚¹

1. **æ™ºèƒ½ä»»åŠ¡åˆ†è§£**ï¼š
   - è‡ªåŠ¨å°†å¤æ‚è¯·æ±‚åˆ†è§£ä¸ºå¤šä¸ªå­ä»»åŠ¡
   - è¯†åˆ«ä»»åŠ¡é—´çš„ä¾èµ–å…³ç³»

2. **ä¾èµ–ç®¡ç†**ï¼š
   - ç¡®ä¿èˆªç­æŸ¥è¯¢åœ¨é…’åº—æŸ¥è¯¢ä¹‹å‰å®Œæˆ
   - åªæœ‰æ‰€æœ‰å‰ç½®ä»»åŠ¡æˆåŠŸæ‰èƒ½æ‰§è¡Œåç»­ä»»åŠ¡

3. **é”™è¯¯å¤„ç†æœºåˆ¶**ï¼š
   - å¯¹æŸ¥è¯¢å¤±è´¥çš„æƒ…å†µæœ‰å®Œå–„çš„é”™è¯¯å¤„ç†
   - æä¾›å‹å¥½çš„é”™è¯¯æç¤ºä¿¡æ¯

4. **æ™ºèƒ½æ—¥æœŸè§£æ**ï¼š
   - æ”¯æŒç›¸å¯¹æ—¥æœŸæè¿°ï¼ˆå¦‚"ä¸‹å‘¨ä¸€"ã€"æ˜å¤©"ç­‰ï¼‰
   - è‡ªåŠ¨è½¬æ¢ä¸ºæ ‡å‡†æ—¥æœŸæ ¼å¼

5. **åŸå¸‚åæ™ºèƒ½è½¬æ¢**ï¼š
   - è‡ªåŠ¨å°†ä¸­æ–‡åŸå¸‚åè½¬æ¢ä¸ºIATAæœºåœºä»£ç 
   - æé«˜èˆªç­æŸ¥è¯¢å‡†ç¡®æ€§

### å¤ç°æ ¸å¿ƒæˆæœçš„å‘½ä»¤

```bash
# è¿è¡Œé»˜è®¤æµ‹è¯•ç”¨ä¾‹
python supervisor_agent.py

# æŸ¥çœ‹æ‰§è¡Œç»“æœ
# ç³»ç»Ÿå°†è¾“å‡ºå®Œæ•´çš„é¢„è®¢ç¡®è®¤ä¿¡æ¯
```

é€šè¿‡ä»¥ä¸Šè®¾è®¡å’Œå®ç°ï¼Œè¯¥æ—…è¡Œè§„åˆ’Agentèƒ½å¤Ÿå¯é åœ°å¤„ç†å¤æ‚çš„å¤šæ­¥éª¤æ—…è¡Œé¢„è®¢ä»»åŠ¡ï¼Œå…·å¤‡è‰¯å¥½çš„æ‰©å±•æ€§å’Œç»´æŠ¤æ€§ã€‚